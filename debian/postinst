#!/bin/bash
# postinst script for jolicloud-tweaks
#
# see: dh_installdeb(1)

set -e

# Application directories
app_dir="/usr/share/jolicloud-tweaks"
save_dir="$app_dir/save"

# Fix the problem with evolution (uninstalled) when the computer is put on AC
if [ -a /etc/acpi/mailbtn.sh ]; then
	chmod -x /etc/acpi/mailbtn.sh
fi

# Fix the shutdown problem
if [ -a /etc/default/halt ]; then
	if [ `cat /etc/default/halt | grep -c "rmmod snd-hda-intel #Automatic fix by jolicloud-tweaks"` -eq 0 ]; then
		echo "\nrmmod snd-hda-intel #Automatic fix by jolicloud-tweaks" >> /etc/default/halt
	fi
fi

# Gconf settings
update-gconf-defaults

# Change the gdm theme
if [ -d /etc/gdm/ ]; then
	if [ ! -a /etc/gdm/gdm.conf-custom ]; then
		touch /etc/gdm/gdm.conf-custom
	fi
	$app_dir/edit-conf /etc/gdm/gdm.conf-custom greeter BackgroundColor "#000000"
	$app_dir/edit-conf /etc/gdm/gdm.conf-custom greeter GraphicalThemedColor "#000000"
	$app_dir/edit-conf /etc/gdm/gdm.conf-custom greeter GraphicalTheme Jolicloud
fi

# Firefox settings
if [ -a /etc/firefox-3.0/pref/ubufox.js ]; then
	while read LINE ; do
		echo "$LINE //Added by jolicloud-tweaks" >> /etc/firefox-3.0/pref/ubufox.js
	done < /etc/firefox-3.0/pref/jolicloud-firefox.js
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
